<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Um Chamado à Edificação</title>
  <script>
    // Injetar as variáveis de ambiente diretamente
    window.ENV = {
      VITE_SUPABASE_URL: "https://mizihlfmbcfgomlutiss.supabase.co",
      VITE_SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pemlobGZtYmNmZ29tbHV0aXNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI5MDA0MjYsImV4cCI6MjA1ODQ3NjQyNn0.4AkfkgtPzFwvAIfZFCT8LxxK2mIk9hgXiwbfvBthzRQ"
    };
    console.log("ENV carregado:", window.ENV);
  </script>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
      color: #1a202c;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .container {
      max-width: 800px;
      padding: 2rem;
      text-align: center;
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(90deg, #3182ce, #805ad5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    p {
      font-size: 1.125rem;
      margin-bottom: 2rem;
      color: #4a5568;
    }
    .button {
      display: inline-block;
      background-color: #3182ce;
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.375rem;
      text-decoration: none;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    .button:hover {
      background-color: #2c5282;
    }
    .error-message {
      color: #e53e3e;
      margin-top: 1rem;
      font-size: 0.875rem;
    }
    .info {
      margin-top: 2rem;
      font-size: 0.875rem;
      color: #718096;
    }
    .loading-spinner {
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 3px solid #3182ce;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
      margin-bottom: 1rem;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="loading">
      <div class="loading-spinner"></div>
      <h1>Um Chamado à Edificação</h1>
      <p>Carregando a aplicação...</p>
      <div class="info">Se a aplicação não carregar em alguns segundos, <br>verifique se JavaScript está habilitado no seu navegador.</div>
    </div>
    
    <div id="error" style="display: none;">
      <h1>Um Chamado à Edificação</h1>
      <p>Ocorreu um problema ao carregar a aplicação.</p>
      <a href="/" class="button">Tentar Novamente</a>
      <div class="error-message" id="error-details"></div>
      <div class="info">
        <p>Opções de diagnóstico:</p>
        <a href="/api/healthcheck">Verificar Status da API</a> | 
        <a href="/static-index.html">Página de Diagnóstico</a>
      </div>
    </div>
  </div>

  <script>
    // Função para verificar se a URL existe
    async function checkUrl(url) {
      try {
        const response = await fetch(url, { method: 'HEAD' });
        return response.ok;
      } catch (e) {
        return false;
      }
    }
    
    // Opções de assets para tentar
    const possibleAssets = [
      '/assets/index.js',
      '/client/assets/index.js',
      '/client/src/main.js',
      '/client/dist/assets/index.js',
      '/index.js'
    ];
    
    // Possíveis pontos de entrada
    const possibleEntries = [
      '/client/index.html',
      '/client/dist/index.html',
      '/dist/index.html'
    ];
    
    // Função para carregar o script principal
    async function loadMainScript() {
      for (const asset of possibleAssets) {
        if (await checkUrl(asset)) {
          console.log(`Script encontrado em: ${asset}`);
          const script = document.createElement('script');
          script.src = asset;
          script.type = 'module';
          script.onload = () => {
            console.log(`Script carregado com sucesso: ${asset}`);
            window.appLoaded = true;
          };
          script.onerror = (e) => {
            console.error(`Erro ao carregar script: ${asset}`, e);
          };
          document.body.appendChild(script);
          return true;
        }
      }
      return false;
    }
    
    // Função para redirecionar para o ponto de entrada principal
    async function redirectToMainEntry() {
      for (const entry of possibleEntries) {
        if (await checkUrl(entry)) {
          console.log(`Ponto de entrada encontrado em: ${entry}`);
          window.location.href = entry;
          return true;
        }
      }
      return false;
    }
    
    // Verificar se conseguimos carregar o principal ou redirecionar
    async function tryLoadApp() {
      // Primeiro tentar carregar o script
      const scriptLoaded = await loadMainScript();
      
      // Se não conseguir carregar o script, tentar redirecionar
      if (!scriptLoaded) {
        const redirected = await redirectToMainEntry();
        
        // Se não conseguir redirecionar, mostrar erro após 3 segundos
        if (!redirected) {
          setTimeout(() => {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            
            // Incluir detalhes de diagnóstico
            document.getElementById('error-details').innerHTML = `
              Detalhes técnicos:<br>
              URL: ${window.location.href}<br>
              Variáveis: ${window.ENV ? 'Disponíveis' : 'Não disponíveis'}<br>
              Timestamp: ${new Date().toISOString()}<br>
              Assets testados: ${possibleAssets.join(', ')}<br>
              Entradas testadas: ${possibleEntries.join(', ')}
            `;
          }, 3000);
        }
      }
    }
    
    // Iniciar processo de carregamento
    tryLoadApp();
  </script>
</body>
</html>