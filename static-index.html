<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diagnóstico de Ambiente Vercel</title>
  <script>
    // Variáveis de ambiente para Supabase (serão injetadas pela Vercel)
    window.ENV = {
      VITE_SUPABASE_URL: "https://mizihlfmbcfgomlutiss.supabase.co",
      VITE_SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pemlobGZtYmNmZ29tbHV0aXNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI5MDA0MjYsImV4cCI6MjA1ODQ3NjQyNn0.4AkfkgtPzFwvAIfZFCT8LxxK2mIk9hgXiwbfvBthzRQ"
    };
    console.log("ENV carregado:", window.ENV);
  </script>
  <style>
    body { font-family: system-ui, sans-serif; line-height: 1.5; max-width: 800px; margin: 0 auto; padding: 1rem; }
    h1 { color: #1a365d; margin-bottom: 1rem; }
    .card { border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem; }
    button { background: #3182ce; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.25rem; cursor: pointer; }
    button:hover { background: #2c5282; }
    pre { background: #f7fafc; padding: 1rem; border-radius: 0.25rem; overflow-x: auto; font-size: 0.875rem; }
    .success { color: #38a169; }
    .error { color: #e53e3e; }
  </style>
</head>
<body>
  <h1>Diagnóstico de Ambiente Vercel</h1>
  
  <div class="card">
    <h2>Verificação de Variáveis de Ambiente</h2>
    <p>Testando a disponibilidade das variáveis críticas:</p>
    <pre id="env-output">Verificando...</pre>
    <button onclick="checkEnv()">Testar Variáveis</button>
  </div>
  
  <div class="card">
    <h2>Teste de Conexão com Supabase</h2>
    <p>Verificando a conectividade com o Supabase:</p>
    <pre id="supabase-output">Aguardando teste...</pre>
    <button onclick="testSupabase()">Testar Conectividade</button>
  </div>
  
  <div class="card">
    <h2>Verificação de Caminhos de Assets</h2>
    <p>Testando resolução de caminhos de arquivos:</p>
    <pre id="paths-output">Aguardando verificação...</pre>
    <button onclick="checkPaths()">Verificar Caminhos</button>
  </div>
  
  <script>
    // Função para verificar variáveis de ambiente
    function checkEnv() {
      const output = document.getElementById('env-output');
      try {
        const env = window.ENV || {};
        const result = [
          'Verificação de Variáveis:',
          '------------------------',
          'window.ENV existe? ' + (window.ENV ? 'Sim' : 'Não'),
          'VITE_SUPABASE_URL: ' + (env.VITE_SUPABASE_URL || 'Não definido'),
          'VITE_SUPABASE_ANON_KEY: ' + (env.VITE_SUPABASE_ANON_KEY ? 'Definido (valor oculto)' : 'Não definido'),
          '',
          'window.origin: ' + window.location.origin,
          'pathname: ' + window.location.pathname
        ].join('\n');
        
        output.textContent = result;
        output.className = window.ENV?.VITE_SUPABASE_URL ? 'success' : 'error';
      } catch (err) {
        output.textContent = 'Erro: ' + err.message;
        output.className = 'error';
      }
    }
    
    // Iniciar verificação automática
    checkEnv();
    
    // Função para testar conexão com Supabase
    async function testSupabase() {
      const output = document.getElementById('supabase-output');
      output.textContent = 'Conectando...';
      
      try {
        // Carregar o Supabase de um CDN para este teste
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js';
        script.onload = async () => {
          try {
            const { createClient } = window.supabase;
            
            if (!window.ENV?.VITE_SUPABASE_URL || !window.ENV?.VITE_SUPABASE_ANON_KEY) {
              throw new Error('Variáveis de ambiente do Supabase não estão definidas');
            }
            
            const supabase = createClient(
              window.ENV.VITE_SUPABASE_URL,
              window.ENV.VITE_SUPABASE_ANON_KEY
            );
            
            output.textContent = 'Cliente Supabase criado, tentando fazer consulta...';
            
            // Teste de consulta simples
            const { data, error } = await supabase
              .from('cartas_um_chamado_a_edificacao')
              .select('id')
              .limit(1);
            
            if (error) throw error;
            
            output.textContent = 'Conexão com Supabase estabelecida com sucesso!\n' + 
                                'Dados recebidos: ' + JSON.stringify(data);
            output.className = 'success';
          } catch (err) {
            output.textContent = 'Erro ao conectar: ' + err.message;
            output.className = 'error';
          }
        };
        
        script.onerror = () => {
          output.textContent = 'Erro ao carregar a biblioteca Supabase';
          output.className = 'error';
        };
        
        document.head.appendChild(script);
      } catch (err) {
        output.textContent = 'Erro: ' + err.message;
        output.className = 'error';
      }
    }
    
    // Função para verificar caminhos de assets
    async function checkPaths() {
      const output = document.getElementById('paths-output');
      output.textContent = 'Verificando caminhos...';
      
      try {
        // Lista de caminhos para verificar
        const paths = [
          '/assets/index.js',
          '/assets/index.css',
          '/public/assets/index.js',
          '/public/assets/index.css',
          '/index.js',
          '/index.css'
        ];
        
        const results = [];
        
        for (const path of paths) {
          try {
            const response = await fetch(path, { method: 'HEAD' });
            results.push(`${path}: ${response.ok ? 'Acessível' : 'Não encontrado (status: ' + response.status + ')'}`);
          } catch (e) {
            results.push(`${path}: Erro ao acessar (${e.message})`);
          }
        }
        
        output.textContent = results.join('\n');
      } catch (err) {
        output.textContent = 'Erro: ' + err.message;
        output.className = 'error';
      }
    }
  </script>
</body>
</html>